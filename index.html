<!DOCTYPE html>
<html lang="en">
  <head>
    <title>The 100 Most Backed Kickstarter Projects</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <!-- import the webpage's stylesheet -->
    <link rel="stylesheet" href="/style.css">
  </head>  
  <body>
    <script src="https://cdn.freecodecamp.org/testable-projects-fcc/v1/bundle.js"></script>
    <h1 id="title">The 100 Most Backed Kickstarter Projects</h1>
    <h3 id="description">Grouped by category</h3>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="https://d3js.org/d3-dsv.v1.min.js"></script>
    <script src="https://d3js.org/d3-fetch.v1.min.js"></script>
    <script src="https://d3js.org/d3-hierarchy.v1.min.js"></script>
    <script>
      const getCategoryColors = category => {
        switch(category){
          case "Product Design":
            return "blue";
            break;
          case "Tabletop Games":
            return "red";
            break;
          case "Gaming Hardware":
            return "green";
            break;
          case "Video Games":
            return "yellow";
            break;
          case "Sound":
            return "orange";
            break;
          case "Television":
            return "brown";
            break;
          case "Narrative Film":
            return "purple";
            break;
          case "Web":
            return "pink";
            break;
          case "Hardware":
            return "skyblue";
            break;
          case "Games":
            return "lightgreen"
            break;
          case "3D Printing":
            return "gray";
            break;
          case "Technology":
            return "tan";
            break;
          case "Wearables":
            return "violet";
            break;
          case "Sculpture":
            return "#FF00EE";
            break;
          case "Apparel":
            return "#00FFAA";
            break;
          case "Food":
            return "#FAFAA0";
            break;
          case "Art":
            return "#3C00AF";
            break;
          case "Gadgets":
            return "#20FF22"
            break;
          case "Drinks":
            return "#C5CF00"
            break;
          default: return "black";
        }
      }
      
      const formatValue = value => {
        return value.replace(/\B(?=(\d{3})+(?!\d))/g, ",")
      }
      
      let tooltip = d3
          .select("body")
          .append("div")
          .attr("id","tooltip")
          .attr("class", "tooltip")
          .style("opacity", 0);
      
      d3.json("https://cdn.rawgit.com/freeCodeCamp/testable-projects-fcc/a80ce8f9/src/data/tree_map/kickstarter-funding-data.json").then(function(data){
        const root = d3.hierarchy(data);
        root.sum(d=>d.value)
        const treemap = d3.treemap().size([900,500])
        treemap(root)
        console.log(root.leaves())
        const svg = d3.select("body").append("svg").attr("width",1000).attr("height",800)
        const cell = svg.selectAll("g")
          .data(root.leaves())
          .enter().append("g")
          .attr("class","group")
          .attr("transform",d=>"translate("+d.x0+","+d.y0+")")
          .on("mouseover", function(d) {
            tooltip
              .style("opacity",1);
            tooltip
              .html(`${d.data.name}<br/>Value: $${formatValue(d.data.value)}`)
              .style("left", d3.event.pageX + 20 + "px")
              .style("top", d3.event.pageY + 20 + "px")
              .attr("data-name", d.data.name)
              .attr("data-value", d.data.value)
          })
          .on("mouseout", function(d) {
            tooltip
              .style("opacity", 0);
          })
        const tile = cell.append("rect")
          .attr("id",d=>d.data.id)
          .attr("class","tile")
          .attr("width",d=>d.x1 - d.x0)
          .attr("height",d=>d.y1 - d.y0)
          .attr("data-name",d=>d.data.name)
          .attr("data-category",d=>d.data.category)
          .attr("data-value",d=>d.data.value)
          .attr("fill",d=>getCategoryColors(d.data.category))
        
        cell.append("text")
          .attr("class","tile-text")
          .selectAll("tspan")
          .data(d=>d.data.name.split(/(?=[A-Z][^A-Z])/g))
          .enter()
          .append("tspan")
          .attr("x",4)
          .attr("y",(d,i)=>13+i*10)
          .text(d=>d)
        
        const legend = svg.append("g")
      })
    </script>
    <!-- include the Glitch button to show what the webpage is about and
          to make it easier for folks to view source and remix -->
    <div class="glitchButton" style="position:fixed;top:20px;right:20px;"></div>
    <script src="https://button.glitch.me/button.js"></script>
  </body>
</html>
